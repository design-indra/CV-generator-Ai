<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Generator AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root { --ink: #1a1a2e; --paper: #f5f0e8; --gold: #c9a84c; --gold-light: #e8d5a3; --cream: #faf7f2; --accent: #2d5a8e; --accent2: #8e2d2d; --shadow: rgba(26,26,46,0.15); }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'DM Sans', sans-serif; background: var(--ink); color: var(--paper); min-height: 100vh; overflow-x: hidden; }
        body::before { content: ''; position: fixed; inset: 0; background: radial-gradient(ellipse 80% 50% at 20% 20%, rgba(201,168,76,0.08) 0%, transparent 60%), radial-gradient(ellipse 60% 80% at 80% 80%, rgba(45,90,142,0.12) 0%, transparent 60%); pointer-events: none; z-index: 0; }
        .grain { position: fixed; inset: 0; opacity: 0.03; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E"); pointer-events: none; z-index: 0; }
        header { position: relative; z-index: 10; text-align: center; padding: 60px 20px 40px; border-bottom: 1px solid rgba(201,168,76,0.2); }
        .logo-tag { display: inline-block; font-size: 11px; letter-spacing: 4px; text-transform: uppercase; color: var(--gold); margin-bottom: 16px; opacity: 0.8; }
        header h1 { font-family: 'Playfair Display', serif; font-size: clamp(2.5rem, 6vw, 4.5rem); font-weight: 900; line-height: 1.05; background: linear-gradient(135deg, var(--paper) 30%, var(--gold) 70%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        header p { margin-top: 16px; color: rgba(245,240,232,0.55); font-size: 1rem; font-weight: 300; letter-spacing: 0.3px; }
        .container { position: relative; z-index: 10; max-width: 1100px; margin: 0 auto; padding: 40px 20px 80px; display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: start; }
        @media (max-width: 780px) { .container { grid-template-columns: 1fr; } }
        .form-panel { background: rgba(245,240,232,0.04); border: 1px solid rgba(201,168,76,0.15); border-radius: 20px; padding: 36px; backdrop-filter: blur(10px); }
        .panel-title { font-family: 'Playfair Display', serif; font-size: 1.3rem; color: var(--gold); margin-bottom: 28px; display: flex; align-items: center; gap: 10px; }
        .panel-title::after { content: ''; flex: 1; height: 1px; background: rgba(201,168,76,0.2); }
        .form-section { margin-bottom: 24px; }
        .section-label { font-size: 10px; letter-spacing: 3px; text-transform: uppercase; color: var(--gold); opacity: 0.6; margin-bottom: 12px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .form-group { display: flex; flex-direction: column; gap: 6px; margin-bottom: 12px; }
        label { font-size: 12px; color: rgba(245,240,232,0.55); letter-spacing: 0.5px; }
        input, select, textarea { background: rgba(245,240,232,0.06); border: 1px solid rgba(201,168,76,0.15); border-radius: 10px; padding: 11px 14px; color: var(--paper); font-family: 'DM Sans', sans-serif; font-size: 14px; transition: all 0.2s; width: 100%; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: rgba(201,168,76,0.5); background: rgba(245,240,232,0.08); }
        .dynamic-item { display: flex; gap: 8px; align-items: center; margin-bottom: 8px; }
        .btn-remove { background: rgba(142,45,45,0.2); border: 1px solid rgba(142,45,45,0.3); color: #e8a0a0; border-radius: 8px; width: 32px; height: 32px; cursor: pointer; }
        .btn-add { display: inline-flex; align-items: center; gap: 6px; font-size: 12px; color: var(--gold); background: rgba(201,168,76,0.08); border: 1px dashed rgba(201,168,76,0.3); border-radius: 8px; padding: 7px 14px; cursor: pointer; margin-top: 6px; }
        .btn-generate { width: 100%; padding: 16px; margin-top: 24px; background: linear-gradient(135deg, var(--gold) 0%, #a07830 100%); color: var(--ink); border: none; border-radius: 12px; font-weight: 600; letter-spacing: 1px; cursor: pointer; transition: all 0.3s; }
        .btn-generate:hover { transform: translateY(-2px); box-shadow: 0 12px 40px rgba(201,168,76,0.35); }
        .cv-wrapper { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 30px 80px rgba(0,0,0,0.4); min-height: 400px; display: flex; align-items: center; justify-content: center; }
        .cv-placeholder { text-align: center; color: rgba(26,26,46,0.3); }
        #cv-content { width: 100%; color: #1a1a2e; }
        .cv-header-bar { background: linear-gradient(135deg, #1a1a2e 0%, #2d3561 100%); padding: 36px; color: white; }
        .cv-name { font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 700; }
        .cv-body { padding: 28px 36px; display: grid; grid-template-columns: 1fr 2fr; gap: 28px; }
        .cv-section-title { font-size: 10px; letter-spacing: 3px; text-transform: uppercase; color: var(--accent); border-bottom: 2px solid var(--accent); margin-bottom: 12px; }
        .cv-section-title-gold { font-size: 10px; letter-spacing: 3px; text-transform: uppercase; color: #8a7040; border-bottom: 2px solid var(--gold); margin-bottom: 12px; }
        .cv-skill-tag { background: rgba(45,90,142,0.1); color: var(--accent); padding: 4px 10px; border-radius: 20px; font-size: 11px; margin: 2px; display: inline-block; }
        .cv-actions { display: flex; gap: 10px; margin-top: 16px; }
        .btn-action { flex: 1; padding: 12px; border-radius: 10px; font-weight: 600; cursor: pointer; border: none; }
        .btn-download { background: var(--gold); color: var(--ink); }
        .status-msg { text-align: center; font-size: 13px; color: var(--gold); margin-top: 12px; opacity: 0; transition: 0.3s; }
        .status-msg.visible { opacity: 1; }
    </style>
</head>
<body>
    <div class="grain"></div>
    <header>
        <div class="logo-tag">‚ú¶ Fullstack Edition</div>
        <h1>CV Generator</h1>
        <p>Isi data Anda dan biarkan AI menyusun kalimat profesional.</p>
    </header>

    <div class="container">
        <div class="form-panel">
            <div class="panel-title">Data Diri</div>
            <div class="form-section">
                <div class="form-row">
                    <div class="form-group"><label>Nama Lengkap *</label><input type="text" id="nama" placeholder="Budi Santoso"></div>
                    <div class="form-group"><label>Tanggal Lahir</label><input type="date" id="tgl_lahir"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Email *</label><input type="email" id="email" placeholder="budi@email.com"></div>
                    <div class="form-group"><label>HP</label><input type="tel" id="telepon" placeholder="+62..."></div>
                </div>
                <div class="form-group"><label>Posisi Dituju *</label><input type="text" id="posisi" placeholder="Contoh: Manager Pemasaran"></div>
            </div>

            <div class="form-section">
                <div class="section-label">Pengalaman</div>
                <div class="dynamic-list" id="exp-list">
                    <div class="dynamic-item"><input type="text" placeholder="2020-2023 | Posisi | Perusahaan"><button class="btn-remove" onclick="removeItem(this)">√ó</button></div>
                </div>
                <button class="btn-add" onclick="addItem('exp-list', 'Tahun | Jabatan | Perusahaan')">+ Pengalaman</button>
            </div>

            <div class="form-section">
                <div class="section-label">Pendidikan</div>
                <div class="dynamic-list" id="edu-list">
                    <div class="dynamic-item"><input type="text" placeholder="Tahun | Gelar | Universitas"><button class="btn-remove" onclick="removeItem(this)">√ó</button></div>
                </div>
                <button class="btn-add" onclick="addItem('edu-list', 'Tahun | Gelar | Universitas')">+ Pendidikan</button>
            </div>

            <div class="form-section">
                <div class="section-label">Keahlian</div>
                <div class="dynamic-list" id="skill-list">
                    <div class="dynamic-item"><input type="text" placeholder="Contoh: Microsoft Office, PHP, Leadership"><button class="btn-remove" onclick="removeItem(this)">√ó</button></div>
                </div>
                <button class="btn-add" onclick="addItem('skill-list', 'Skill lainnya')">+ Skill</button>
            </div>

            <button class="btn-generate" id="gen-btn" onclick="generateCV()">
                <span id="gen-label">‚ú¶ Generate CV Sekarang</span>
            </button>
            <div class="status-msg" id="status-msg"></div>
        </div>

        <div class="cv-panel">
            <div class="panel-title">Preview</div>
            <div class="cv-wrapper" id="cv-wrapper">
                <div class="cv-placeholder">CV akan muncul di sini...</div>
            </div>
            <div class="cv-actions" id="cv-actions" style="display:none">
                <button class="btn-action btn-download" onclick="window.print()">üñ® Print ke PDF</button>
            </div>
        </div>
    </div>

    <script>
        function addItem(id, ph) {
            const el = document.getElementById(id);
            const div = document.createElement('div');
            div.className = 'dynamic-item';
            div.innerHTML = `<input type="text" placeholder="${ph}"><button class="btn-remove" onclick="removeItem(this)">√ó</button>`;
            el.appendChild(div);
        }
        function removeItem(b) { if(b.closest('.dynamic-list').children.length > 1) b.closest('.dynamic-item').remove(); }
        function getVals(id) { return Array.from(document.querySelectorAll(`#${id} input`)).map(i => i.value).filter(Boolean); }
        function setStatus(m, v=true) { const s = document.getElementById('status-msg'); s.textContent = m; s.classList.toggle('visible', v); }

        async function generateCV() {
            const nama = document.getElementById('nama').value;
            const email = document.getElementById('email').value;
            const posisi = document.getElementById('posisi').value;
            if(!nama || !email || !posisi) return setStatus('Lengkapi Nama, Email, dan Posisi!');

            const btn = document.getElementById('gen-btn');
            btn.disabled = true;
            setStatus('ü§ñ AI sedang menyusun CV Anda...');

            const prompt = `Buat CV JSON profesional untuk ${nama} pada posisi ${posisi}. Pengalaman: ${getVals('exp-list').join(', ')}. Pendidikan: ${getVals('edu-list').join(', ')}. Skills: ${getVals('skill-list').join(', ')}. Kembalikan hanya JSON murni: {"nama":"","posisi_target":"","email":"","ringkasan":"","pengalaman":[{"jabatan":"","perusahaan":"","periode":"","deskripsi":[]}],"pendidikan":[{"gelar":"","institusi":"","tahun":""}],"skills":[]}`;

            try {
                const res = await fetch('/.netlify/functions/generate', {
                    method: 'POST',
                    body: JSON.stringify({ prompt })
                });
                const data = await res.json();
                const rawText = data.content[0].text;
                const jsonStr = rawText.match(/\{[\s\S]*\}/)[0];
                renderCV(JSON.parse(jsonStr));
                setStatus('‚úÖ Selesai!');
                document.getElementById('cv-actions').style.display = 'flex';
            } catch (e) {
                setStatus('‚ùå Error: ' + e.message);
            } finally { btn.disabled = false; }
        }

        function renderCV(cv) {
            document.getElementById('cv-wrapper').innerHTML = `
                <div id="cv-content">
                    <div class="cv-header-bar">
                        <div class="cv-name">${cv.nama}</div>
                        <div class="cv-title">${cv.posisi_target}</div>
                        <div style="font-size:12px; opacity:0.8">${cv.email}</div>
                    </div>
                    <div class="cv-body">
                        <div>
                            <div class="cv-section-title-gold">Skills</div>
                            ${cv.skills.map(s => `<span class="cv-skill-tag">${s}</span>`).join('')}
                            <div class="cv-section-title-gold" style="margin-top:20px">Pendidikan</div>
                            ${cv.pendidikan.map(e => `<div style="font-size:11px"><b>${e.gelar}</b><br>${e.institusi} (${e.tahun})</div>`).join('<br>')}
                        </div>
                        <div>
                            <div class="cv-section-title">Profil</div>
                            <p style="font-size:12px; line-height:1.6">${cv.ringkasan}</p>
                            <div class="cv-section-title" style="margin-top:20px">Pengalaman</div>
                            ${cv.pengalaman.map(p => `<div style="margin-bottom:15px"><b style="font-size:13px">${p.jabatan}</b><br><small>${p.perusahaan} | ${p.periode}</small><br><p style="font-size:11px">${p.deskripsi.join('<br>')}</p></div>`).join('')}
                        </div>
                    </div>
                </div>`;
        }
    </script>
</body>
</html>
